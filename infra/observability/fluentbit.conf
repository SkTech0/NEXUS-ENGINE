# Fluent Bit â€” Nexus Engine logging
# Structured logs, trace IDs, correlation IDs

[SERVICE]
    Flush         5
    Log_Level     info
    Parsers_File  parsers.conf

# Engine API stdout
[INPUT]
    Name              forward
    Listen            0.0.0.0
    Port              24224
    Buffer_Chunk_Size 1M
    Buffer_Max_Size   6M

[INPUT]
    Name              tail
    Path              /var/log/engine-api/*.log
    Parser            json
    Tag               engine-api
    Refresh_Interval  10
    Skip_Long_Lines   On
    DB                /var/log/flb_engine.db
    Mem_Buf_Limit     50MB

[FILTER]
    Name          nest
    Match         *
    Operation     lift
    Nested_under  log
    Add_prefix    log_

[FILTER]
    Name          modify
    Match         *
    Add           trace_id ${trace_id}
    Add           correlation_id ${correlation_id}

[OUTPUT]
    Name   stdout
    Match  *
    Format json_lines

[OUTPUT]
    Name          loki
    Match         *
    Host          loki
    Port          3100
    Labels        job=nexus-engine
    Auto_retry_limit 5
